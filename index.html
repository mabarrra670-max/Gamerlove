<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Love Clicker - Pro Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --bg: #0f1016;
            --card: #1c1e29;
            --primary: #ff4d6d;
            --accent: #7209b7;
            --text-main: #ffffff;
            --text-dim: #a0a0a0;
            --gold: #ffca28;
        }

        * { box-sizing: border-box; font-family: 'Poppins', sans-serif; }

        body {
            margin: 0; background-color: var(--bg); color: var(--text-main);
            display: flex; justify-content: center; min-height: 100vh;
        }

        .app-container { width: 100%; max-width: 480px; padding-bottom: 80px; position: relative; }

        /* TAB SYSTEM */
        .tab-content { display: none; padding: 20px; animation: fadeIn 0.4s ease; }
        .active-tab { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* BOTTOM NAVIGATION */
        .bottom-nav {
            position: fixed; bottom: 0; left: 50%; transform: translateX(-50%);
            width: 100%; max-width: 480px; background: var(--card);
            display: flex; justify-content: space-around; padding: 15px 0;
            border-top: 1px solid rgba(255,255,255,0.05); z-index: 100;
        }

        .nav-item { cursor: pointer; display: flex; flex-direction: column; align-items: center; font-size: 11px; color: var(--text-dim); }
        .nav-item.active { color: var(--primary); font-weight: bold; }
        .nav-icon { font-size: 20px; margin-bottom: 4px; }

        /* WINNER PODIUM SECTION */
        .podium-container {
            display: flex; justify-content: center; align-items: flex-end; margin: 30px 0; gap: 10px;
        }

        .podium-item { text-align: center; position: relative; }
        .podium-item.rank-1 { order: 2; transform: translateY(-20px); }
        .podium-item.rank-2 { order: 1; }
        .podium-item.rank-3 { order: 3; }

        .podium-img {
            width: 60px; height: 60px; border-radius: 50%; border: 3px solid var(--text-dim);
            object-fit: cover; background: #333;
        }
        .rank-1 .podium-img { width: 90px; height: 90px; border-color: var(--gold); box-shadow: 0 0 20px rgba(255,202,40,0.3); }

        .crown { position: absolute; top: -15px; left: 50%; transform: translateX(-50%); font-size: 20px; display: none; }
        .rank-1 .crown { display: block; }

        /* PROFILE STYLING */
        .profile-header { text-align: center; background: var(--card); padding: 30px; border-radius: 30px; margin-bottom: 20px; }
        .main-profile-img { width: 120px; height: 120px; border-radius: 50%; border: 4px solid var(--primary); object-fit: cover; }
        
        /* CARD LIST */
        .list-item {
            background: var(--card); padding: 15px; border-radius: 18px;
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;
        }

        /* BUTTONS */
        .btn-action {
            background: linear-gradient(45deg, var(--primary), var(--accent));
            color: white; border: none; padding: 15px; border-radius: 15px;
            width: 100%; font-weight: 700; margin-top: 10px; cursor: pointer;
        }

        .score-big { font-size: 60px; font-weight: 800; color: var(--primary); text-align: center; margin: 20px 0; }
        
        input { width: 100%; padding: 12px; margin: 5px 0; border-radius: 12px; border: none; background: #2d303e; color: white; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="app-container">
        <div id="auth-section" class="tab-content active-tab" style="margin-top:50px;">
            <h2 style="text-align:center;">‚ú® Love Clicker Pro</h2>
            <div class="profile-header">
                <input type="email" id="email" placeholder="Email">
                <input type="password" id="password" placeholder="Password">
                <input type="text" id="username" placeholder="Nama Panggilan">
                <button class="btn-action" onclick="handleLogin()">MASUK</button>
                <p onclick="handleRegister()" style="font-size:12px; color:var(--text-dim); cursor:pointer; margin-top:15px;">Belum punya akun? Daftar di sini</p>
            </div>
        </div>

        <div id="tab-game" class="tab-content">
            <h3 style="text-align:center;">Love Engine</h3>
            <div class="score-big" id="score">0</div>
            <div style="text-align:center; margin-bottom:40px;">
                <button id="love-btn" style="background:none; border:none; font-size:100px; cursor:pointer;">üíñ</button>
            </div>
            <button class="btn-action" onclick="saveScore()">SIMPAN SKOR ONLINE</button>
            <button class="btn-action" style="background:rgba(255,255,255,0.1);" onclick="askQuestion()">BONUS POIN (+50)</button>
        </div>

        <div id="tab-leaderboard" class="tab-content">
            <h3 style="text-align:center;">Top Lovers</h3>
            
            <div class="podium-container" id="podium-area">
                <div class="podium-item rank-2">
                    <img src="" id="p2-img" class="podium-img">
                    <div id="p2-name" style="font-size:11px; margin-top:5px;">...</div>
                </div>
                <div class="podium-item rank-1">
                    <div class="crown">üëë</div>
                    <img src="" id="p1-img" class="podium-img">
                    <div id="p1-name" style="font-size:13px; font-weight:700; margin-top:5px;">...</div>
                </div>
                <div class="podium-item rank-3">
                    <img src="" id="p3-img" class="podium-img">
                    <div id="p3-name" style="font-size:11px; margin-top:5px;">...</div>
                </div>
            </div>

            <div id="leaderboard-list">
                </div>
        </div>

        <div id="tab-profile" class="tab-content">
            <div class="profile-header">
                <img src="" id="my-photo" class="main-profile-img">
                <h2 id="display-name" style="margin:10px 0 0 0;">User</h2>
                <p style="color:var(--text-dim); font-size:12px;">Love Member</p>
                
                <label style="color:var(--primary); font-size:12px; cursor:pointer;">
                    <input type="file" id="file-input" accept="image/*" style="display:none;">
                    üì∏ Ganti Foto Profil
                </label>
            </div>

            <div class="list-item">
                <span>Poin Saat Ini</span>
                <b id="profile-score" style="color:var(--primary);">0</b>
            </div>
            <button class="btn-action" style="background:#e63946;" onclick="auth.signOut(); location.reload();">LOGOUT</button>
        </div>

        <div class="bottom-nav hidden" id="bottom-nav">
            <div class="nav-item" onclick="switchTab('tab-game', this)">
                <span class="nav-icon">üéÆ</span><span>Main</span>
            </div>
            <div class="nav-item" onclick="switchTab('tab-leaderboard', this)">
                <span class="nav-icon">üèÜ</span><span>Peringkat</span>
            </div>
            <div class="nav-item" onclick="switchTab('tab-profile', this)">
                <span class="nav-icon">üë§</span><span>Profil</span>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyCyMnLJJo2QTZZ7cBGigtj0BNNfqjHngvU",
          authDomain: "loveclicker-86b7e.firebaseapp.com",
          projectId: "loveclicker-86b7e",
          storageBucket: "loveclicker-86b7e.firebasestorage.app",
          messagingSenderId: "219092692738",
          appId: "1:219092692738:web:e5eb08a2c0dd7b2cf59c1b",
          measurementId: "G-KM1GZ74EBN"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        let currentScore = 0;
        let currentUser = null;
        let base64Image = "https://cdn-icons-png.flaticon.com/512/3135/3135715.png";

        function switchTab(tabId, el) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active-tab'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(tabId).classList.add('active-tab');
            el.classList.add('active');
            if(tabId === 'tab-leaderboard') loadLeaderboard();
        }

        // Handle Photo Upload
        document.getElementById('file-input').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onloadend = function() {
                base64Image = reader.result;
                document.getElementById('my-photo').src = base64Image;
                alert("Foto terpilih! Jangan lupa SIMPAN di menu Main.");
            }
            if (file) reader.readAsDataURL(file);
        });

        function handleRegister() {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('password').value;
            const name = document.getElementById('username').value;
            auth.createUserWithEmailAndPassword(email, pass).then((u) => {
                u.user.updateProfile({ displayName: name });
                db.collection("users").doc(u.user.uid).set({ name: name, score: 0, photo: base64Image });
                alert("Daftar Berhasil!");
            }).catch(e => alert(e.message));
        }

        function handleLogin() {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('password').value;
            auth.signInWithEmailAndPassword(email, pass).catch(e => alert(e.message));
        }

        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = user;
                document.getElementById('auth-section').classList.remove('active-tab');
                document.getElementById('tab-game').classList.add('active-tab');
                document.getElementById('bottom-nav').classList.remove('hidden');
                loadUserData();
            }
        });

        document.getElementById('love-btn').onclick = () => {
            currentScore++;
            document.getElementById('score').innerText = currentScore;
        };

        async function loadUserData() {
            const doc = await db.collection("users").doc(currentUser.uid).get();
            if (doc.exists) {
                const data = doc.data();
                currentScore = data.score || 0;
                base64Image = data.photo || base64Image;
                document.getElementById('score').innerText = currentScore;
                document.getElementById('profile-score').innerText = currentScore;
                document.getElementById('display-name').innerText = data.name;
                document.getElementById('my-photo').src = base64Image;
            }
        }

        async function saveScore() {
            await db.collection("users").doc(currentUser.uid).set({ 
                name: document.getElementById('display-name').innerText, 
                score: currentScore,
                photo: base64Image
            }, { merge: true });
            alert("Skor & Foto Berhasil Disinkron!");
            loadLeaderboard();
        }

        function askQuestion() {
            let q = prompt("Ketik 'sayang' untuk bonus:");
            if(q && q.toLowerCase() === "sayang") {
                currentScore += 50;
                document.getElementById('score').innerText = currentScore;
            }
        }

        async function loadLeaderboard() {
            const snapshot = await db.collection("users").orderBy("score", "desc").limit(15).get();
            let html = "";
            let players = [];
            snapshot.forEach(doc => players.push(doc.data()));

            // Update Podium (3 Besar)
            if(players[0]) {
                document.getElementById('p1-img').src = players[0].photo;
                document.getElementById('p1-name').innerText = players[0].name;
            }
            if(players[1]) {
                document.getElementById('p2-img').src = players[1].photo;
                document.getElementById('p2-name').innerText = players[1].name;
            }
            if(players[2]) {
                document.getElementById('p3-img').src = players[2].photo;
                document.getElementById('p3-name').innerText = players[2].name;
            }

            // Update List Sisa
            for(let i = 3; i < players.length; i++) {
                html += `
                <div class="list-item">
                    <div style="display:flex; align-items:center;">
                        <span style="margin-right:15px; color:var(--text-dim);">${i+1}</span>
                        <img src="${players[i].photo}" style="width:35px; height:35px; border-radius:50%; margin-right:10px; object-fit:cover;">
                        <b>${players[i].name}</b>
                    </div>
                    <b>${players[i].score}</b>
                </div>`;
            }
            document.getElementById('leaderboard-list').innerHTML = html;
        }
    </script>
</body>
    </html>
